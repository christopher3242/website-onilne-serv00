<!DOCTYPE html>
<html lang="en">
  <head>

    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,
      initial-scale=1.0">
    <title>2048 Game</title>
    <style>
  body {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: start;
    margin: 0;
    padding: 20px;
    font-family: Arial, sans-serif;
    background: #faf8ef;
  }

  h1 {
    text-align: center;
    font-size: 3em;
    margin-bottom: 10px;
  }

  #score-container {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 10px;
  }

  .score-box {
    background: #bbada0;
    padding: 10px 20px;
    border-radius: 8px;
    color: #fff;
    font-size: 1.2em;
    min-width: 120px;
    text-align: center;
  }

  #game-container {
    display: grid;
    grid-template-columns: repeat(4, 80px);
    grid-gap: 10px;
    margin: 20px 0;
    justify-content: center;
  }

  .tile {
    width: 80px;
    height: 80px;
    background: #cdc1b4;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2em;
    font-weight: bold;
    transition: all 0.2s ease;
  }

  /* Tile colors based on value */
  .tile-2 { background-color: #eee4da; }
  .tile-4 { background-color: #ede0c8; }
  .tile-8 { background-color: #f2b179; color: #fff; }
  .tile-16 { background-color: #f59563; color: #fff; }
  .tile-32 { background-color: #f67c5f; color: #fff; }
  .tile-64 { background-color: #f65e3b; color: #fff; }
  .tile-128 { background-color: #edcf72; }
  .tile-256 { background-color: #edcc61; }
  .tile-512 { background-color: #edc850; }
  .tile-1024 { background-color: #edc53f; }
  .tile-2048 { background-color: #edc22e; }

  #controls {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    flex-wrap: wrap;
    justify-content: center;
  }

  button {
    padding: 10px 20px;
    font-size: 1em;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    background-color: #8f7a66;
    color: #fff;
    transition: background 0.2s ease;
  }

  button:hover {
    background-color: #a67c55;
  }

  /* Game Over overlay styles */
  #game-over {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.7);
    display: none; /* hidden by default */
    align-items: center;
    justify-content: center;
    flex-direction: column;
    z-index: 999;
  }

  #game-over h2 {
    color: #fff;
    font-size: 2em;
    margin-bottom: 20px;
  }

  #game-over button {
    margin: 10px;
    padding: 10px 20px;
    font-size: 1em;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    background-color: #8f7a66;
    color: #fff;
  }

  #game-over button:hover {
    background-color: #a67c55;
  }
</style>
  </head>
  <body>
    <h1>2048 Game</h1>
    <div id="score-container">
      <div class="score-box">Score: <span id="score">0</span></div>
      <div class="score-box">Top Score: <span id="topScore">0</span></div>
    </div>
    <div id="controls"> <a href="../Games.html"><button id="exitBtn">Exit</button></a>
      <button id="cheatBtn">Cheat Mode</button> <button
        id="spamHighBtn">Spam High Tiles</button> <button
        id="restartBtn">Restart</button>
    </div>
    <div id="game-container"></div>
    <!-- Game Over Overlay -->
    <div id="game-over">
      <h2>Game Over!</h2>
      <button id="restartBtn2">Restart</button> <button
        id="closeGameOver">Close</button>
    </div>
    <script>
  const size = 4;
  let board = [];
  let score = 0;
  let topScore = 0;
  let gameOver = false;
  let cheatMode = false;

  const container = document.getElementById('game-container');
  const scoreSpan = document.getElementById('score');
  const topScoreSpan = document.getElementById('topScore');
  const gameOverDiv = document.getElementById('game-over');

  function loadTopScore() {
    const savedTop = localStorage.getItem('topScore');
    if (savedTop) {
      topScore = parseInt(savedTop);
      topScoreSpan.textContent = topScore;
    }
  }

  function saveTopScore() {
    localStorage.setItem('topScore', topScore);
  }

  function init() {
    board = [];
    for (let i=0; i<size; i++) {
      board.push(new Array(size).fill(0));
    }
    score = 0;
    gameOver = false;
    cheatMode = false;
    updateScore();
    spawnTile();
    spawnTile();
    updateUI();
  }

  function updateScore() {
    scoreSpan.textContent = score;
    if (score > topScore) {
      topScore = score;
      topScoreSpan.textContent = topScore;
      saveTopScore();
    }
  }

  function spawnTile() {
    let empty = [];
    for (let i=0; i<size; i++) {
      for (let j=0; j<size; j++) {
        if (board[i][j] === 0) empty.push({i,j});
      }
    }
    if (empty.length === 0) return;
    const rand = empty[Math.floor(Math.random() * empty.length)];
    board[rand.i][rand.j] = Math.random() < 0.9 ? 2 : 4;
  }

  function updateUI() {
    container.innerHTML = '';
    for (let i=0; i<size; i++) {
      for (let j=0; j<size; j++) {
        const tile = document.createElement('div');
        tile.className = 'tile';
        const val = board[i][j];
        if (val !== 0) {
          tile.textContent = val;
          tile.classList.add('tile-' + val);
        } else {
          tile.textContent = '';
        }
        container.appendChild(tile);
      }
    }
  }

  function slide(row) {
    let arr = row.filter(val => val);
    let missing = size - arr.length;
    let zeros = new Array(missing).fill(0);
    arr = arr.concat(zeros);
    return arr;
  }

  function combine(row) {
    for (let i=0; i<row.length-1; i++) {
      if (row[i] !== 0 && row[i] === row[i+1]) {
        row[i] *= 2;
        score += row[i];
        row[i+1] = 0;
      }
    }
    return row;
  }

  function moveLeft() {
    let moved = false;
    for (let i=0; i<size; i++) {
      let original = [...board[i]];
      let row = slide(board[i]);
      row = combine(row);
      row = slide(row);
      board[i] = row;
      if (!arraysEqual(original, row)) moved = true;
    }
    return moved;
  }

  function moveRight() {
    let moved = false;
    for (let i=0; i<size; i++) {
      let original = [...board[i]];
      let reversed = [...board[i]].reverse();
      let row = slide(reversed);
      row = combine(row);
      row = slide(row);
      row.reverse();
      if (!arraysEqual(original, row)) moved = true;
      board[i] = row;
    }
    return moved;
  }

  function moveUp() {
    let moved = false;
    for (let j=0; j<size; j++) {
      let col = [];
      for (let i=0; i<size; i++) col.push(board[i][j]);
      let original = [...col];
      let newCol = slide(col);
      newCol = combine(newCol);
      newCol = slide(newCol);
      for (let i=0; i<size; i++) board[i][j] = newCol[i];
      if (!arraysEqual(original, newCol)) moved = true;
    }
    return moved;
  }

  function moveDown() {
    let moved = false;
    for (let j=0; j<size; j++) {
      let col = [];
      for (let i=0; i<size; i++) col.push(board[i][j]);
      let original = [...col];
      col.reverse();
      let newCol = slide(col);
      newCol = combine(newCol);
      newCol = slide(newCol);
      newCol.reverse();
      for (let i=0; i<size; i++) board[i][j] = newCol[i];
      if (!arraysEqual(original, newCol)) moved = true;
    }
    return moved;
  }

  function arraysEqual(a, b) {
    return a.every((val, index) => val === b[index]);
  }

  function isGameOver() {
    for (let i=0; i<size; i++) {
      for (let j=0; j<size; j++) {
        if (board[i][j] === 0) return false;
        if (i < size -1 && board[i][j] === board[i+1][j]) return false;
        if (j < size -1 && board[i][j] === board[i][j+1]) return false;
      }
    }
    return true;
  }

  function gameOverScreen() {
    document.getElementById('game-over').style.display = 'flex';
  }

  function hideGameOver() {
    document.getElementById('game-over').style.display = 'none';
  }

  // Keyboard controls
  document.addEventListener('keydown', (e) => {
    if (gameOver) return;
    let moved = false;
    switch(e.key) {
      case 'ArrowLeft':
        moved = moveLeft();
        break;
      case 'ArrowRight':
        moved = moveRight();
        break;
      case 'ArrowUp':
        moved = moveUp();
        break;
      case 'ArrowDown':
        moved = moveDown();
        break;
    }
    if (moved) {
      spawnTile();
      updateUI();
      updateScore();
      if (isGameOver()) {
        gameOver = true;
        gameOverScreen();
      }
    }
  });

  // Button Event Listeners
  document.getElementById('restartBtn').addEventListener('click', () => {
    init();
  });

  document.getElementById('restartBtn2').addEventListener('click', () => {
    init();
    hideGameOver();
  });

  document.getElementById('closeGameOver').addEventListener('click', () => {
    hideGameOver();
  });


  document.getElementById('cheatBtn').addEventListener('click', () => {
    cheatMode = true;
    // Generate a high tile
    board[Math.floor(Math.random()*size)][Math.floor(Math.random()*size)] = 2048;
    updateUI();
  });

  document.getElementById('spamHighBtn').addEventListener('click', () => {
    // Fill the board with high tiles
    for (let i=0; i<size; i++) {
      for (let j=0; j<size; j++) {
        board[i][j] = 1024;
      }
    }
    updateUI();
    updateScore();
  });

  // Support swipe for mobile
  let startX = 0;
  let startY = 0;
  document.addEventListener('touchstart', (e) => {
    startX = e.touches[0].clientX;
    startY = e.touches[0].clientY;
  });
  document.addEventListener('touchend', (e) => {
    if (gameOver) return;
    const dx = e.changedTouches[0].clientX - startX;
    const dy = e.changedTouches[0].clientY - startY;
    let moved = false;
    if (Math.abs(dx) > Math.abs(dy)) {
      if (dx > 30) {
        moved = moveRight();
      } else if (dx < -30) {
        moved = moveLeft();
      }
    } else {
      if (dy > 30) {
        moved = moveDown();
      } else if (dy < -30) {
        moved = moveUp();
      }
    }
    if (moved) {
      spawnTile();
      updateUI();
      updateScore();
      if (isGameOver()) {
        gameOver = true;
        gameOverScreen();
      }
    }
  });

  // Initialize game
  loadTopScore();
  init();
</script>
  </body>
</html>
